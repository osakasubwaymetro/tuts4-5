<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>çµ±è¨ˆæƒ…å ± | tuts4</title>
<style>
  body {
    font-family: "Hiragino Sans", "Segoe UI", sans-serif;
    background-color: #F7F8FA;
    margin: 0;
    padding: 20px;
  }

  header {
    text-align: center;
    margin-bottom: 25px;
  }

  h2 {
    color: #004C97;
  }

  #container {
    background: #fff;
    border-radius: 15px;
    padding: 20px 25px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    max-width: 600px;
    margin: 0 auto;
  }

  .rank-item {
    padding: 12px 10px;
    border-bottom: 1px solid #eee;
    font-size: 16px;
    display: flex;
    justify-content: space-between;
  }
  .rank-item:last-child {
    border-bottom: none;
  }

  .rank-num {
    font-weight: bold;
    color: #004C97;
  }

  .back-btn {
    display: block;
    margin: 25px auto 0;
    width: 200px;
    padding: 10px;
    text-align: center;
    background-color: #004C97;
    color: #fff;
    text-decoration: none;
    border-radius: 6px;
    transition: 0.2s;
  }

  .back-btn:hover {
    background-color: #E60012;
  }
</style>
</head>
<body>

<header>
  <h2>ğŸ“Š åˆ©ç”¨è·¯ç·šãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2>
  <p>ï¼ˆã‚ãªãŸã®æŠ•ç¨¿å±¥æ­´ã‹ã‚‰è‡ªå‹•é›†è¨ˆï¼‰</p>
</header>

<div id="container">
  <p>èª­ã¿è¾¼ã¿ä¸­â€¦</p>
</div>

<a class="back-btn" href="index.html">â† æˆ»ã‚‹</a>

<script>
// --- ã‚ãªãŸã®æ—¢å­˜ä»•æ§˜ã«åˆã‚ã›ãŸ GAS API URL ---
const GAS_URL = "https://script.google.com/macros/s/AKfycbwDjgFbOxG6K22TdgbVZ1FJvEtpjZPAI1KArnvLgitFH3lS7yGb_JaQ-LpcgaFTiac7/exec";

// ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼å
const username = localStorage.getItem("username");

// --- å±¥æ­´å–å¾—ï¼ˆè‡ªåˆ†ãŒæŠ•ç¨¿ã—ãŸåˆ†ã ã‘ï¼‰ ---
async function loadMyHistory() {
  const res = await fetch(`${GAS_URL}?action=getHistory&username=ABC&alloworigin=*`);
  return await res.json();  // [{ route:"è°·ç”ºç·š", ... }, ...]
}

// --- è·¯ç·šãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚’ä½œæˆ ---
async function makeRanking() {
  const container = document.getElementById("container");
  container.innerHTML = "èª­ã¿è¾¼ã¿ä¸­â€¦";

  const history = await loadMyHistory();

  if (!history || history.length === 0) {
    container.innerHTML = "<p>ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>";
    return;
  }

  // è·¯ç·šã”ã¨ã®å›æ•°é›†è¨ˆ
  const countMap = {};
  history.forEach(row => {
    const r = row.route;
    if (!r) return;
    countMap[r] = (countMap[r] || 0) + 1;
  });

  // ã‚½ãƒ¼ãƒˆ
  const ranking = Object.entries(countMap)
    .sort((a, b) => b[1] - a[1]);  // [[è·¯ç·š, å›æ•°], ...]

  // è¡¨ç¤º
  container.innerHTML = "";
  ranking.forEach((item, i) => {
    const div = document.createElement("div");
    div.className = "rank-item";
    div.innerHTML = `
      <span class="rank-num">${i+1} ä½</span>
      <span>${item[0]}</span>
      <span>${item[1]} å›</span>
    `;
    container.appendChild(div);
  });
}

makeRanking();
</script>

</body>
</html>

