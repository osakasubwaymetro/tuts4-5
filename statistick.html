<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>çµ±è¨ˆæƒ…å ± | tuts4</title>
<style>
  body {
    font-family: "Hiragino Sans", "Segoe UI", sans-serif;
    background-color: #F7F8FA;
    margin: 0;
    padding: 20px;
  }

  header {
    text-align: center;
    margin-bottom: 25px;
  }

  h2 {
    color: #004C97;
  }

  #container {
    background: #fff;
    border-radius: 15px;
    padding: 20px 25px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.15);
    max-width: 600px;
    margin: 0 auto;
  }

  .rank-item {
    padding: 12px 10px;
    border-bottom: 1px solid #eee;
    font-size: 16px;
    display: flex;
    justify-content: space-between;
  }
  .rank-item:last-child {
    border-bottom: none;
  }

  .rank-num {
    font-weight: bold;
    color: #004C97;
  }

  .back-btn {
    display: block;
    margin: 25px auto 0;
    width: 200px;
    padding: 10px;
    text-align: center;
    background-color: #004C97;
    color: #fff;
    text-decoration: none;
    border-radius: 6px;
    transition: 0.2s;
  }

  .back-btn:hover {
    background-color: #E60012;
  }
</style>
</head>
<body>

<header>
  <h2>ğŸ“Š åˆ©ç”¨è·¯ç·šãƒ©ãƒ³ã‚­ãƒ³ã‚°</h2>
  <p>ï¼ˆã‚ãªãŸã®æŠ•ç¨¿å±¥æ­´ã‹ã‚‰è‡ªå‹•é›†è¨ˆï¼‰</p>
</header>

<div id="container">
  <p>èª­ã¿è¾¼ã¿ä¸­â€¦</p>
</div>

<a class="back-btn" href="index.html">â† æˆ»ã‚‹</a>

<script>
/* ã‚ãªãŸã® GASï¼ˆå…¨ãƒ‡ãƒ¼ã‚¿å–å¾—APIï¼‰ */
const GAS_URL = "https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLjpe1sdvDkmU92PLELfU1Z6qGpkz3JtNzZMWQ5iZ79DE7Qwur0fbT5slCeCmWRosaBka8Eb4ywmBoVXpTHgpNp7UDqWLeTcej8TJTHn_weTFxVNyU20A8NwFwn3qBQOjxriuJeNDvooL6ZyjaahhF0LHthfOsPkDrszUpzMOQG7CXLz-80GQV1_yJoNdqKf8ESkiCm1uGwenkXBbjez9OvKe7BxISLzvazxu5ZrOAKxcGwV30ubCJG-dgmOCsaYXgmfAtyNOkiF1ZfRLDgoxhbGayrm8w&lib=MRswRzEmnRmsQ67EMIpHjkR6HlHeBI2fu";

/* ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼å */
const myName = localStorage.getItem("username");

/* æœªãƒ­ã‚°ã‚¤ãƒ³ãªã‚‰ãƒˆãƒƒãƒ—ã¸ */
if (!myName) {
  alert("ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚");
  location.href = "login.html";
}

/* ã™ã¹ã¦ã®å±¥æ­´ã‚’å–å¾— */
async function getAllHistory() {
  const res = await fetch(GAS_URL);
  return await res.json();  // [{ route:"è°·ç”ºç·š", username:"aaa", ...}, ...]
}

/* è‡ªåˆ†ã®æŠ•ç¨¿ã ã‘æŠ½å‡º â†’ è·¯ç·šãƒ©ãƒ³ã‚­ãƒ³ã‚°ä½œæˆ */
async function makeRanking() {
  const container = document.getElementById("container");
  container.innerHTML = "èª­ã¿è¾¼ã¿ä¸­â€¦";

  const all = await getAllHistory();

  // è‡ªåˆ†ã®æŠ•ç¨¿ã®ã¿
  const mine = all.filter(r => r["åå‰"] === myName);

  if (mine.length === 0) {
    container.innerHTML = "<p>ã‚ãªãŸã®æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>";
    return;
  }

  /* è·¯ç·šã”ã¨ã«é›†è¨ˆ */
  const count = {};
  mine.forEach(row => {
    const r = row["è·¯ç·š"];
    if (!r) return;
    count[r] = (count[r] || 0) + 1;
  });

  /* ã‚½ãƒ¼ãƒˆ */
  const ranking = Object.entries(count)
    .sort((a, b) => b[1] - a[1]);

  /* è¡¨ç¤º */
  container.innerHTML = "";
  ranking.forEach((item, i) => {
    const div = document.createElement("div");
    div.className = "rank-item";
    div.innerHTML = `
      <span class="rank-num">${i+1} ä½</span>
      <span>${item[0]}</span>
      <span>${item[1]} å›</span>
    `;
    container.appendChild(div);
  });
}

makeRanking();
</script>

</body>
</html>


